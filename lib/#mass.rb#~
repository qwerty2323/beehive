#!/usr/bin/ruby -wKU
require_relative 'CsvReader'
require_relative 'counter'
require_relative 'sugarcalculator'

class MassRating
  attr_reader :mass_rating, :pollen_data

  def initialize
    @pollen_data  = CsvReader.new.pollen_data
    @harvest_data = CsvReader.new.harvest_data
    @mass_rating  = []
    @pollen       = Counter.new.pollen
  end

  def analyze
    @pollen.each do |pollen_id|
      harvested_mass(pollen_id)
    end
    @mass_rating
  end
  
  def mass
    analyze
    puts "The most mass was produced from #{@pollen_data[sug_idx][:name]}"
  end

  def idx
    @mass_rating.index { |x| x == @mass_rating.max }
  end

  def by(pollen_id)
    @table.select { |item| item[:pollen_id] == pollen_id }
  end

  def harvested_sugar(pollen_id)
    sugar_array = []
    by(pollen_id).each do |item|
      sugar_array << SugarCalculator.new(mass: item[:mass], pollen_id: pollen_id).sugar
    end
    @sugar_rating << sugar_array.reduce(:+)
  end  
end