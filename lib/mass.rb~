#!/usr/bin/ruby -wKU
require_relative 'CsvReader'
require_relative 'counter'

class MassRating
  attr_reader :mass_rating, :pollen_data

  def initialize
    @pollen_data  = CsvReader.pollen
    @harvest_data = CsvReader.harvest
    @mass_rating  = []
    @pollen       = Counter.new.pollen
  end

  def analyze
    @pollen.each do |pollen_id|
      harvested_mass(pollen_id)
    end
    @mass_rating
  end
  
  def mass
    analyze
    puts "The most mass was produced from #{@pollen_data[idx][:name]}"
  end

  def idx
    @mass_rating.index { |x| x == @mass_rating.max }
  end

  def by(pollen_id)
    @table.select { |item| item[:pollen_id] == pollen_id }
  end

  def harvested_mass(pollen_id)
    mass_array = []
    by(pollen_id).each do |item|
      mass_array << item[:mass]
    end
    @mass_rating << mass_array.reduce(:+)
  end  
end
